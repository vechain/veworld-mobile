# Contact Management - Create and Validation tests
appId: org.vechain.veworld.app
env:
    CONTACT_NAME_1: "My Contact 1"
    CONTACT_ADDRESS_1: "0x36dede00f1e23644f46f765a446daf5fee033f03"
    CONTACT_NAME_2: "My Contact 2"
    # intentionally invalid (43 chars instead of 42)
    CONTACT_ADDRESS_2: "0xB6108eA355b04867A68F294d6197b667789361a12c"
    CONTACT_NAME_3: "My Contact 3"
---
- launchApp:
      clearState: true

# Welcome screen - tap DEV:DEMO
- tapOn:
      id: "dev_demo"

# Dismiss push notification bottom sheet if visible
- runFlow:
      when:
          visible:
              id: "button_notifications_enable"
      commands:
          - tapOn:
                id: "button_notifications_skip"

# Navigate to Settings -> My Contacts
- tapOn:
      id: "settings-tab"
- scrollUntilVisible:
      element:
          id: "My Contacts"
      direction: DOWN
      timeout: 20000
- tapOn:
      id: "My Contacts"
- extendedWaitUntil:
      visible:
          id: "ContactsScreen"
      timeout: 10000

########################################
# 1. Create a new valid contact
########################################
- tapOn:
      id: "Add_Contact_Button"
- extendedWaitUntil:
      visible:
          id: "Add_Contact_Screen"
      timeout: 10000
- tapOn:
      id: "Contact-Name-Input"
- inputText: ${CONTACT_NAME_1}
- tapOn:
      id: "Contact-Address-Input"
- inputText: ${CONTACT_ADDRESS_1}
- hideKeyboard
- tapOn:
      id: "Add_Contact_Button"
- extendedWaitUntil:
      visible:
          id: "ContactsScreen"
      timeout: 10000

########################################
# 2. Attempt to add contact with INVALID address (should show error)
########################################
- assertVisible:
      id: "Add_Contact_Button"
- tapOn:
      id: "Add_Contact_Button"
- extendedWaitUntil:
      visible:
          id: "Add_Contact_Screen"
      timeout: 10000
- tapOn:
      id: "Contact-Name-Input"
- inputText: ${CONTACT_NAME_2}
- tapOn:
      id: "Contact-Address-Input"
- inputText: ${CONTACT_ADDRESS_2}
- hideKeyboard
- assertVisible: "Please enter a valid Vechain address"
- tapOn:
      id: "BackButtonHeader-BaseIcon-backButton"

########################################
# 3. Attempt to add contact with EXISTING address (should show error)
########################################
- extendedWaitUntil:
      visible:
          id: "ContactsScreen"
      timeout: 10000
- assertVisible:
      id: "Add_Contact_Button"
- tapOn:
      id: "Add_Contact_Button"
- extendedWaitUntil:
      visible:
          id: "Add_Contact_Screen"
      timeout: 10000
- tapOn:
      id: "Contact-Name-Input"
- inputText: ${CONTACT_NAME_3}
- tapOn:
      id: "Contact-Address-Input"
- inputText: ${CONTACT_ADDRESS_1}
- hideKeyboard
- assertVisible: "Address already exists in contacts"
- tapOn:
      id: "BackButtonHeader-BaseIcon-backButton"

# Wait for ContactsScreen
- extendedWaitUntil:
      visible:
          id: "ContactsScreen"
      timeout: 10000

########################################
# Reset the app
########################################
- runFlow: ../setup_reset/resetApp.yaml
