appId: org.vechain.veworld.app
onFlowComplete:
    - runFlow: ../setup_reset/resetApp.yaml
tags:
    - pull-request
env:
    # CARP token address (mainnet custom token)
    CUSTOM_TOKEN_ADDRESS: "0x8a9844e4750f5ce5f7988c4d1e04c278c718feea"
---
- launchApp:
      clearState: true

- runFlow:
      when:
          visible: "Enable Dictation?"
      commands:
          - tapOn: "Not Now"

- tapOn:
      id: "dev_demo"

- runFlow:
      when:
          visible:
              id: "VersionUpdateAvailableBottomSheet"
      commands:
          - tapOn:
                id: "Update_Later_Button"

- runFlow:
      when:
          visible:
              id: "VersionChangelogBottomSheet"
      commands:
          - tapOn:
                id: "Dismiss_Button"

- runFlow:
      when:
          visible:
              id: "button_notifications_enable"
      commands:
          - tapOn:
                id: "button_notifications_skip"

- runFlow:
      when:
          visible:
              id: "close-button"
      commands:
          - tapOn:
                id: "close-button"

- extendedWaitUntil:
      visible:
          id: "BalanceScreen_ManageTokensButton"
      timeout: 15000

## Test 1: User can open manage tokens screen
- tapOn:
      id: "BalanceScreen_ManageTokensButton"

# Verify manage tokens screen loaded
- assertVisible: "Manage Tokens"
- assertVisible: "Unselected"

## Test 2: User can search for a token
- tapOn:
      id: "ManageTokenScreen_SearchInput_searchTokenInput"
- inputText: "GOLD"
# GOLD token should appear in search results
- assertVisible: "GOLD"

# Clear search by going back
- tapOn:
      id: "BackButtonHeader-BaseIcon-backButton"

## Test 3: User can add a custom token (Android only)
# Custom token addition works reliably only on Android
- runFlow:
      when:
          platform: Android
      commands:
          - extendedWaitUntil:
                visible:
                    id: "BalanceScreen_ManageTokensButton"
                timeout: 10000
          - tapOn:
                id: "BalanceScreen_ManageTokensButton"
          - tapOn:
                id: "ManageTokenScreen_AddCustomToken_Button"
          - tapOn:
                id: "AddCustomTokenBottomSheet-TextInput-Address"
          # Handle autofill/password save dialog if visible
          - runFlow:
                when:
                    visible:
                        id: "android:id/closeButton"
                commands:
                    - tapOn:
                          id: "android:id/closeButton"
          - inputText: ${CUSTOM_TOKEN_ADDRESS}
          - extendedWaitUntil:
                visible: "Add"
                timeout: 15000
          - tapOn: "Add"
          # Verify CARP token was added (should appear in list)
          - extendedWaitUntil:
                visible: "CARP"
                timeout: 10000
          - assertVisible: "CARP"
          # Go back to wallet
          - tapOn:
                id: "BackButtonHeader-BaseIcon-backButton"

## Test 4: Final verification - wallet screen loads correctly
- extendedWaitUntil:
      visible:
          id: "BalanceScreen_ManageTokensButton"
      timeout: 10000

# Final check - Tokens tab should be visible
- assertVisible: "Tokens"
